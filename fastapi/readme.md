# Fastapi сервис

## Использование

Из папки fastapi

Запуск сервиса:
```
python main.py
```

Запуск тестов (для тестов необходим файл ../data/cbr-press-releases.csv - результат работы скрапинга):
```
pytest -s tests/test.py 
```


Проверка и исправление стиля
```
python -m pycodestyle --max-line-length 120 *.py tests/*.py
python -m flake8 --max-line-length=120 *.py tests/*.py
pylint --max-line-length=120 --disable="C0103,C0114,C0115" *.py tests/*.py #Тут надо попотеть, чтобы все проходило =)

python -m black --line-length 120 *.py tests/*.py
```

Экспорт openapi.yaml
```
python extract-openapi.py main:app
```

## Описание
- Сервис держит в памяти данные и обученные модели. Все это сохраняется во время завершения работы и загружается во время запуска

## Описание ручек

### /
Статус сервера, количество наблюдений и обученных моделей

### /fit
Обучает модель, принимает тип модели, описание и гиперпараметры. Если модель обучается, то она добавляется в память, сохранение в файл произойдет при завершении сервиса.

Для обучения выбрал две модели, показавшие лучшие данные на прошлом чекпоинте, это LogisticRegression и SVC
(но на их основе можно создавать много моделей в сервисе с разными гиперпараметрами)

Трансформер для них одинаковый - Tfidf

### /get_data
Выдает все наблюдения, хранящиеся в памяти сервиса

### /get_models
Выдает описания всех обученных моделей, готовых к инференсу

### /load_data
Принимает и запоминает наблюдения. Если такое наблюдение (по дате) уже существует - то обновляет его

### /predict{model_id}
Делает предсказание указанной моделью (текст релиза берется из последней записи данных в памяти сервиса) Возвращает класс и вероятности классов

